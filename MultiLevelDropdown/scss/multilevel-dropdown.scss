// MultiLevelDropdown SCSS
// Bootstrap 5.3 compatible multi-level dropdown styles

// Variables using Bootstrap's CSS custom properties
:root {
	--multilevel-max-width: 300px;
	--multilevel-min-width: 180px;
	--multilevel-column-gap: 0.5rem;
	--multilevel-item-padding-x: var(--bs-dropdown-item-padding-x, 1rem);
	--multilevel-item-padding-y: var(--bs-dropdown-item-padding-y, 0.25rem);
	--multilevel-border-radius: var(--bs-dropdown-border-radius, 0.375rem);
	--multilevel-box-shadow: var(--bs-dropdown-box-shadow, 0 0.5rem 1rem rgba(0, 0, 0, 0.175));
	--multilevel-bg: var(--bs-dropdown-bg, #fff);
	--multilevel-border-color: var(--bs-dropdown-border-color, var(--bs-border-color-translucent));
	--multilevel-animation-duration: 200ms;
	--multilevel-animation-easing: ease-out;
}

// Dark mode variables
[data-bs-theme="dark"] {
	--multilevel-bg: var(--bs-dropdown-bg, #212529);
	--multilevel-border-color: var(--bs-dropdown-border-color, var(--bs-border-color-translucent));
}

// Base multilevel dropdown
.multilevel-dropdown {
	// Ensure proper positioning context
	&.dropdown-menu {
		position: relative;
	}

	// Submenu containers
	.dropdown-submenu {
		position: relative;

		// Submenu toggle styling
		.dropdown-toggle {
			position: relative;

			// Add arrow indicator
			&::after {
				content: '';
				position: absolute;
				top: 50%;
				right: var(--multilevel-item-padding-x);
				transform: translateY(-50%);
				width: 0;
				height: 0;
				border-left: 0.3em solid currentColor;
				border-top: 0.3em solid transparent;
				border-bottom: 0.3em solid transparent;
				margin-left: 0.5rem;
			}

			// Remove Bootstrap's default caret
			&::before {
				display: none;
			}
		}

		// Nested dropdown menu
		.dropdown-menu {
			position: absolute;
			top: 0;
			left: 100%;
			min-width: var(--multilevel-min-width);
			max-width: var(--multilevel-max-width);
			margin-top: 0;
			margin-left: 0;
			border-radius: var(--multilevel-border-radius);
			box-shadow: var(--multilevel-box-shadow);
			background-color: var(--multilevel-bg);
			border: 1px solid var(--multilevel-border-color);
			display: none;
			z-index: 1000;

			// Animation setup
			opacity: 0;
			transform: translateX(-10px);
			transition: opacity var(--multilevel-animation-duration) var(--multilevel-animation-easing),
						transform var(--multilevel-animation-duration) var(--multilevel-animation-easing);

			// Shown state
			&.show {
				display: block;
				opacity: 1;
				transform: translateX(0);
			}
		}

		// Active submenu state
		&.submenu-open {
			> .dropdown-toggle {
				background-color: var(--bs-dropdown-link-hover-bg);
				color: var(--bs-dropdown-link-hover-color);
			}

			> .dropdown-menu {
				display: block;
				opacity: 1;
				transform: translateX(0);
			}
		}

		// Left-aligned submenu
		&.submenu-left,
		&.dropdown-left {
			.dropdown-menu {
				left: -100%;
				right: auto;
			}

			.dropdown-toggle::after {
				border-left: none;
				border-right: 0.3em solid currentColor;
				right: auto;
				left: var(--multilevel-item-padding-x);
			}
		}

		// Right-aligned submenu (default)
		&.submenu-right,
		&.dropdown-right {
			.dropdown-menu {
				left: 100%;
				right: auto;
			}
		}
	}
}

// Multi-column layouts
.dropdown-menu {
	// 2-column layout
	&.dropdown-columns-2 {
		columns: 2;
		column-gap: var(--multilevel-column-gap);
		min-width: calc(var(--multilevel-min-width) * 1.8);
		max-width: calc(var(--multilevel-max-width) * 1.5);

		.dropdown-item {
			break-inside: avoid;
			page-break-inside: avoid;
		}
	}

	// 3-column layout
	&.dropdown-columns-3 {
		columns: 3;
		column-gap: var(--multilevel-column-gap);
		min-width: calc(var(--multilevel-min-width) * 2.5);
		max-width: calc(var(--multilevel-max-width) * 2);

		.dropdown-item {
			break-inside: avoid;
			page-break-inside: avoid;
		}
	}

	// 4-column layout
	&.dropdown-columns-4 {
		columns: 4;
		column-gap: var(--multilevel-column-gap);
		min-width: calc(var(--multilevel-min-width) * 3.2);
		max-width: calc(var(--multilevel-max-width) * 2.5);

		.dropdown-item {
			break-inside: avoid;
			page-break-inside: avoid;
		}
	}
}

// Responsive behavior
@media (max-width: 991.98px) {
	.multilevel-dropdown {
		// Stack submenus on smaller screens
		.dropdown-submenu {
			.dropdown-menu {
				position: static;
				display: none;
				float: none;
				width: auto;
				margin-top: 0;
				background-color: transparent;
				border: 0;
				box-shadow: none;
				padding-left: 1rem;
			}

			&.submenu-open .dropdown-menu {
				display: block;
			}

			.dropdown-toggle::after {
				border-left: none;
				border-top: 0.3em solid currentColor;
				border-right: 0.3em solid transparent;
				border-bottom: none;
				border-left: 0.3em solid transparent;
				transform: translateY(-50%) rotate(0deg);
			}

			&.submenu-open .dropdown-toggle::after {
				transform: translateY(-50%) rotate(180deg);
			}
		}

		// Disable columns on mobile
		.dropdown-menu {
			&.dropdown-columns-2,
			&.dropdown-columns-3,
			&.dropdown-columns-4 {
				columns: 1;
				min-width: auto;
				max-width: none;
			}
		}
	}
}

// Tablet adjustments
@media (min-width: 768px) and (max-width: 991.98px) {
	.dropdown-menu {
		&.dropdown-columns-3,
		&.dropdown-columns-4 {
			columns: 2;
		}
	}
}

// Large screen optimizations
@media (min-width: 1200px) {
	:root {
		--multilevel-max-width: 350px;
		--multilevel-min-width: 200px;
	}
}

// Hover effects
.multilevel-dropdown {
	.dropdown-submenu {
		.dropdown-toggle {
			transition: background-color 0.15s ease-in-out,
						color 0.15s ease-in-out;
		}

		&:hover > .dropdown-toggle:not(:disabled):not(.disabled) {
			background-color: var(--bs-dropdown-link-hover-bg);
			color: var(--bs-dropdown-link-hover-color);
		}
	}
}

// Focus styles for accessibility
.multilevel-dropdown {
	.dropdown-item:focus,
	.dropdown-toggle:focus {
		outline: 2px solid var(--bs-primary);
		outline-offset: -2px;
	}
}

// RTL support
[dir="rtl"] {
	.multilevel-dropdown {
		.dropdown-submenu {
			.dropdown-toggle::after {
				right: auto;
				left: var(--multilevel-item-padding-x);
				border-left: none;
				border-right: 0.3em solid currentColor;
			}

			.dropdown-menu {
				left: -100%;
				right: auto;
			}

			&.dropdown-left .dropdown-menu {
				left: 100%;
				right: auto;
			}

			&.dropdown-left .dropdown-toggle::after {
				border-right: none;
				border-left: 0.3em solid currentColor;
				left: auto;
				right: var(--multilevel-item-padding-x);
			}
		}
	}
}

// High contrast mode support
@media (prefers-contrast: high) {
	.multilevel-dropdown {
		.dropdown-menu {
			border-width: 2px;
		}

		.dropdown-item:focus,
		.dropdown-toggle:focus {
			outline-width: 3px;
		}
	}
}

// Reduced motion support
@media (prefers-reduced-motion: reduce) {
	:root {
		--multilevel-animation-duration: 0ms;
	}

	.multilevel-dropdown {
		.dropdown-submenu .dropdown-menu {
			transition: none;
		}

		.dropdown-toggle {
			transition: none;
		}
	}
}

// Print styles
@media print {
	.multilevel-dropdown {
		.dropdown-submenu .dropdown-menu {
			position: static !important;
			display: block !important;
			opacity: 1 !important;
			transform: none !important;
			box-shadow: none !important;
			border: 1px solid #000 !important;
			margin-left: 1rem;
		}
	}
}